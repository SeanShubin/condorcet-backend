health()
mapOf(Pair("service", "ok"), Pair("database", "ok"))

register("Alice", "alice@email.com", "alice-password")
Tokens(RefreshToken("Alice"),AccessToken("Alice", OWNER))

permissionsForRole(OWNER)
listOf(TRANSFER_OWNER,VIEW_SECRETS,MANAGE_USERS,USE_APPLICATION,VIEW_APPLICATION)

register("Bob", "bob@email.com", "bob-password")
Tokens(RefreshToken("Bob"),AccessToken("Bob", OBSERVER))

permissionsForRole(OBSERVER)
listOf(VIEW_APPLICATION)

register("Carol", "carol@email.com", "carol-password")
Tokens(RefreshToken("Carol"),AccessToken("Carol", OBSERVER))

permissionsForRole(OBSERVER)
listOf(VIEW_APPLICATION)

register("Dave", "dave@email.com", "dave-password")
Tokens(RefreshToken("Dave"),AccessToken("Dave", OBSERVER))

permissionsForRole(OBSERVER)
listOf(VIEW_APPLICATION)

register("Eve", "eve@email.com", "eve-password")
Tokens(RefreshToken("Eve"),AccessToken("Eve", OBSERVER))

permissionsForRole(OBSERVER)
listOf(VIEW_APPLICATION)

authenticate("Alice", "alice-password")
Tokens(RefreshToken("Alice"),AccessToken("Alice", OWNER))

permissionsForRole(OWNER)
listOf(TRANSFER_OWNER,VIEW_SECRETS,MANAGE_USERS,USE_APPLICATION,VIEW_APPLICATION)

refresh(RefreshToken("Alice"))
Tokens(RefreshToken("Alice"),AccessToken("Alice", OWNER))

permissionsForRole(OWNER)
listOf(TRANSFER_OWNER,VIEW_SECRETS,MANAGE_USERS,USE_APPLICATION,VIEW_APPLICATION)

setRole(AccessToken("Alice", OWNER), "Bob", USER)
Unit

setRole(AccessToken("Alice", OWNER), "Dave", USER)
Unit

setRole(AccessToken("Alice", OWNER), "Eve", USER)
Unit

removeUser(AccessToken("Alice", OWNER), "Carol")
Unit

listUsers(AccessToken("Alice", OWNER))
listOf(UserNameRole("Alice", OWNER, listOf(OWNER)),UserNameRole("Bob", USER, listOf(NO_ACCESS,OBSERVER,USER,ADMIN,AUDITOR,OWNER)),UserNameRole("Dave", USER, listOf(NO_ACCESS,OBSERVER,USER,ADMIN,AUDITOR,OWNER)),UserNameRole("Eve", USER, listOf(NO_ACCESS,OBSERVER,USER,ADMIN,AUDITOR,OWNER)))

addElection(AccessToken("Alice", OWNER), "Delete Me")
Unit

addElection(AccessToken("Alice", OWNER), "Favorite Ice Cream Flavor")
Unit

updateElection(AccessToken("Alice", OWNER), "Favorite Ice Cream Flavor", ElectionUpdates("Favorite Ice Cream", true, true, null, true, null))
Unit

setCandidates(AccessToken("Alice", OWNER), "Favorite Ice Cream", listOf("Chocolate","Vanilla","Strawberry"))
Unit

setEligibleVoters(AccessToken("Alice", OWNER), "Favorite Ice Cream", listOf("Alice","Bob","Dave"))
Unit

listEligibility(AccessToken("Alice", OWNER), "Favorite Ice Cream")
listOf(VoterEligibility("Alice", true),VoterEligibility("Bob", true),VoterEligibility("Dave", true),VoterEligibility("Eve", false))

isEligible(AccessToken("Alice", OWNER), "Alice", "Favorite Ice Cream")
true

launchElection(AccessToken("Alice", OWNER), "Favorite Ice Cream", true)
Unit

castBallot(AccessToken("Alice", OWNER), "Alice", "Favorite Ice Cream", listOf(Ranking("Vanilla", 1),Ranking("Chocolate", 2)))
Unit

setCandidates(AccessToken("Alice", OWNER), "Favorite Ice Cream", listOf("Butter Pecan","Chocolate","Neapolitan","Vanilla","Mint","Chocolate Chip"))
Unit

castBallot(AccessToken("Alice", OWNER), "Alice", "Favorite Ice Cream", listOf(Ranking("Chocolate Chip", 1),Ranking("Neapolitan", 2),Ranking("Chocolate", 3),Ranking("Vanilla", 4),Ranking("Butter Pecan", 5),Ranking("Mint", 6)))
Unit

listRankings(AccessToken("Alice", OWNER), "Alice", "Favorite Ice Cream")
listOf(Ranking("Chocolate Chip", 1),Ranking("Neapolitan", 2),Ranking("Chocolate", 3),Ranking("Vanilla", 4),Ranking("Butter Pecan", 5),Ranking("Mint", 6))

getElection(AccessToken("Alice", OWNER), "Favorite Ice Cream")
ElectionDetail("Alice", "Favorite Ice Cream", 6, 3, true, null, null, true, true)

deleteElection(AccessToken("Alice", OWNER), "Delete Me")
Unit

listElections(AccessToken("Alice", OWNER))
listOf(ElectionSummary("Alice", "Favorite Ice Cream", true, null, null, true, true))

listCandidates(AccessToken("Alice", OWNER), "Favorite Ice Cream")
listOf("Butter Pecan","Chocolate","Chocolate Chip","Mint","Neapolitan","Vanilla")

listTables(AccessToken("Alice", OWNER))
listOf("int_variable","role_permission","user","election","candidate","voter","ballot","ranking")

userCount(AccessToken("Alice", OWNER))
4

electionCount(AccessToken("Alice", OWNER))
1

tableCount(AccessToken("Alice", OWNER))
8

eventCount(AccessToken("Alice", OWNER))
21

tableData(AccessToken("Alice", OWNER), "user")
TableData(listOf("id","name","email","role","salt","hash"), listOf(listOf(1,"Alice","alice@email.com","OWNER","3EDA01A7D056605C3C778E0179EC2AE3","4F9E9E2A359F92CAAFA507E7880638E15BF4F68D1A9250688CDA8B87221B68F8"),listOf(2,"Bob","bob@email.com","USER","79E90A5258764397DA853AFCED2F88E7","80C423B16D0C9AF27A95362F0878674736259463102B89CF9B2387E0F10EBB7C"),listOf(4,"Dave","dave@email.com","USER","299B27AEEF6F189B4C56090474AC5239","4BBF4E6580F022C50E1BFD10F9CF0DD3D310D1712BA4BE8F9296BEF3792C7CB5"),listOf(5,"Eve","eve@email.com","USER","11DD7B4117C780908F18A402A48C8079","98E94206D70222DCB5B7360C64E80898AF6BDC3ACEB046B8945A02B7515BB211")))

debugTableData(AccessToken("Alice", OWNER), "election")
TableData(listOf("id","owner_id","owner","name","secret_ballot","no_voting_before","no_voting_after","allow_edit","allow_vote"), listOf(listOf(2,1,"Alice","Favorite Ice Cream",true,null,null,true,true)))

eventData(AccessToken("Alice", OWNER))
TableData(listOf("id","when","authority","type","text"), listOf(listOf(1,Instant.parse("2022-01-21T06:18:24.586708Z"),"Alice","AddUser","{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"3EDA01A7D056605C3C778E0179EC2AE3\",\"hash\":\"4F9E9E2A359F92CAAFA507E7880638E15BF4F68D1A9250688CDA8B87221B68F8\",\"role\":\"OWNER\"}"),listOf(2,Instant.parse("2022-01-21T06:18:24.789737Z"),"Bob","AddUser","{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"79E90A5258764397DA853AFCED2F88E7\",\"hash\":\"80C423B16D0C9AF27A95362F0878674736259463102B89CF9B2387E0F10EBB7C\",\"role\":\"OBSERVER\"}"),listOf(3,Instant.parse("2022-01-21T06:18:24.923599Z"),"Carol","AddUser","{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"E79BFDA7276912CC49F1DC28BA2E8CBD\",\"hash\":\"5D3B307F0C357D4687FC3A658473C204DB825F831AB12B7DED00AF05E11EA914\",\"role\":\"OBSERVER\"}"),listOf(4,Instant.parse("2022-01-21T06:18:25.034614Z"),"Dave","AddUser","{\"name\":\"Dave\",\"email\":\"dave@email.com\",\"salt\":\"299B27AEEF6F189B4C56090474AC5239\",\"hash\":\"4BBF4E6580F022C50E1BFD10F9CF0DD3D310D1712BA4BE8F9296BEF3792C7CB5\",\"role\":\"OBSERVER\"}"),listOf(5,Instant.parse("2022-01-21T06:18:25.168424Z"),"Eve","AddUser","{\"name\":\"Eve\",\"email\":\"eve@email.com\",\"salt\":\"11DD7B4117C780908F18A402A48C8079\",\"hash\":\"98E94206D70222DCB5B7360C64E80898AF6BDC3ACEB046B8945A02B7515BB211\",\"role\":\"OBSERVER\"}"),listOf(6,Instant.parse("2022-01-21T06:18:25.470894Z"),"Alice","SetRole","{\"name\":\"Bob\",\"role\":\"USER\"}"),listOf(7,Instant.parse("2022-01-21T06:18:25.534425Z"),"Alice","SetRole","{\"name\":\"Dave\",\"role\":\"USER\"}"),listOf(8,Instant.parse("2022-01-21T06:18:25.585081Z"),"Alice","SetRole","{\"name\":\"Eve\",\"role\":\"USER\"}"),listOf(9,Instant.parse("2022-01-21T06:18:25.647237Z"),"Alice","RemoveUser","{\"name\":\"Carol\"}"),listOf(10,Instant.parse("2022-01-21T06:18:25.782896Z"),"Alice","AddElection","{\"owner\":\"Alice\",\"name\":\"Delete Me\"}"),listOf(11,Instant.parse("2022-01-21T06:18:25.834248Z"),"Alice","AddElection","{\"owner\":\"Alice\",\"name\":\"Favorite Ice Cream Flavor\"}"),listOf(12,Instant.parse("2022-01-21T06:18:25.955359Z"),"Alice","UpdateElection","{\"name\":\"Favorite Ice Cream Flavor\",\"updates\":{\"newElectionName\":\"Favorite Ice Cream\",\"secretBallot\":true,\"clearNoVotingBefore\":true,\"noVotingBefore\":null,\"clearNoVotingAfter\":true,\"noVotingAfter\":null,\"allowVote\":null,\"allowEdit\":null}}"),listOf(13,Instant.parse("2022-01-21T06:18:26.036475Z"),"Alice","AddCandidates","{\"electionName\":\"Favorite Ice Cream\",\"candidateNames\":[\"Chocolate\",\"Vanilla\",\"Strawberry\"]}"),listOf(14,Instant.parse("2022-01-21T06:18:26.115180Z"),"Alice","AddVoters","{\"electionName\":\"Favorite Ice Cream\",\"voterNames\":[\"Alice\",\"Bob\",\"Dave\"]}"),listOf(15,Instant.parse("2022-01-21T06:18:26.273102Z"),"Alice","UpdateElection","{\"name\":\"Favorite Ice Cream\",\"updates\":{\"newElectionName\":null,\"secretBallot\":null,\"clearNoVotingBefore\":null,\"noVotingBefore\":null,\"clearNoVotingAfter\":null,\"noVotingAfter\":null,\"allowVote\":true,\"allowEdit\":true}}"),listOf(16,Instant.parse("2022-01-21T06:18:26.362508Z"),"Alice","CastBallot","{\"voterName\":\"Alice\",\"electionName\":\"Favorite Ice Cream\",\"rankings\":[{\"candidateName\":\"Vanilla\",\"rank\":1},{\"candidateName\":\"Chocolate\",\"rank\":2}],\"confirmation\":\"D7ED737E6DF479C9EA2E6B28B416A733\",\"now\":\"2022-01-21T06:18:26.350790Z\"}"),listOf(17,Instant.parse("2022-01-21T06:18:26.428303Z"),"Alice","RemoveCandidates","{\"electionName\":\"Favorite Ice Cream\",\"candidateNames\":[\"Strawberry\"]}"),listOf(18,Instant.parse("2022-01-21T06:18:26.437569Z"),"Alice","AddCandidates","{\"electionName\":\"Favorite Ice Cream\",\"candidateNames\":[\"Butter Pecan\",\"Neapolitan\",\"Mint\",\"Chocolate Chip\"]}"),listOf(19,Instant.parse("2022-01-21T06:18:26.488168Z"),"Alice","SetRankings","{\"confirmation\":\"D7ED737E6DF479C9EA2E6B28B416A733\",\"electionName\":\"Favorite Ice Cream\",\"rankings\":[{\"candidateName\":\"Chocolate Chip\",\"rank\":1},{\"candidateName\":\"Neapolitan\",\"rank\":2},{\"candidateName\":\"Chocolate\",\"rank\":3},{\"candidateName\":\"Vanilla\",\"rank\":4},{\"candidateName\":\"Butter Pecan\",\"rank\":5},{\"candidateName\":\"Mint\",\"rank\":6}]}"),listOf(20,Instant.parse("2022-01-21T06:18:26.515328Z"),"Alice","UpdateWhenCast","{\"confirmation\":\"D7ED737E6DF479C9EA2E6B28B416A733\",\"now\":\"2022-01-21T06:18:26.481986Z\"}"),listOf(21,Instant.parse("2022-01-21T06:18:26.691208Z"),"Alice","DeleteElection","{\"name\":\"Delete Me\"}")))

authenticate("Bob", "bob-password")
Tokens(RefreshToken("Bob"),AccessToken("Bob", USER))

permissionsForRole(USER)
listOf(USE_APPLICATION,VIEW_APPLICATION)

castBallot(AccessToken("Bob", USER), "Bob", "Favorite Ice Cream", listOf(Ranking("Chocolate", 1),Ranking("Chocolate Chip", 2),Ranking("Vanilla", 3),Ranking("Mint", 4),Ranking("Butter Pecan", 5),Ranking("Neapolitan", 6)))
Unit

authenticate("Dave", "dave-password")
Tokens(RefreshToken("Dave"),AccessToken("Dave", USER))

permissionsForRole(USER)
listOf(USE_APPLICATION,VIEW_APPLICATION)

castBallot(AccessToken("Dave", USER), "Dave", "Favorite Ice Cream", listOf(Ranking("Mint", 1),Ranking("Chocolate Chip", 2),Ranking("Neapolitan", 3),Ranking("Chocolate", 4),Ranking("Vanilla", 5),Ranking("Butter Pecan", 6)))
Unit

authenticate("Alice", "alice-password")
Tokens(RefreshToken("Alice"),AccessToken("Alice", OWNER))

permissionsForRole(OWNER)
listOf(TRANSFER_OWNER,VIEW_SECRETS,MANAGE_USERS,USE_APPLICATION,VIEW_APPLICATION)

finalizeElection(AccessToken("Alice", OWNER), "Favorite Ice Cream")
Unit

tally(AccessToken("Alice", OWNER), "Favorite Ice Cream")
Tally(listOf("Chocolate Chip","Chocolate","Mint","Neapolitan","Vanilla","Butter Pecan"), true, listOf(SecretBallot("Favorite Ice Cream", "760D2BFB08D64A9F416FADDCAE168028", listOf(Ranking("Chocolate Chip", 2),Ranking("Chocolate", 4),Ranking("Mint", 1),Ranking("Neapolitan", 3),Ranking("Vanilla", 5),Ranking("Butter Pecan", 6))),SecretBallot("Favorite Ice Cream", "B922EC70D29A75C87659972712FB67EC", listOf(Ranking("Chocolate Chip", 2),Ranking("Chocolate", 1),Ranking("Mint", 4),Ranking("Neapolitan", 6),Ranking("Vanilla", 3),Ranking("Butter Pecan", 5))),SecretBallot("Favorite Ice Cream", "D7ED737E6DF479C9EA2E6B28B416A733", listOf(Ranking("Chocolate Chip", 1),Ranking("Chocolate", 3),Ranking("Mint", 6),Ranking("Neapolitan", 2),Ranking("Vanilla", 4),Ranking("Butter Pecan", 5)))), listOf(listOf(Preference("Chocolate Chip", 0, "Chocolate Chip"),Preference("Chocolate Chip", 2, "Chocolate"),Preference("Chocolate Chip", 2, "Mint"),Preference("Chocolate Chip", 3, "Neapolitan"),Preference("Chocolate Chip", 3, "Vanilla"),Preference("Chocolate Chip", 3, "Butter Pecan")),listOf(Preference("Chocolate", 1, "Chocolate Chip"),Preference("Chocolate", 0, "Chocolate"),Preference("Chocolate", 2, "Mint"),Preference("Chocolate", 1, "Neapolitan"),Preference("Chocolate", 3, "Vanilla"),Preference("Chocolate", 3, "Butter Pecan")),listOf(Preference("Mint", 1, "Chocolate Chip"),Preference("Mint", 1, "Chocolate"),Preference("Mint", 0, "Mint"),Preference("Mint", 2, "Neapolitan"),Preference("Mint", 1, "Vanilla"),Preference("Mint", 2, "Butter Pecan")),listOf(Preference("Neapolitan", 0, "Chocolate Chip"),Preference("Neapolitan", 2, "Chocolate"),Preference("Neapolitan", 1, "Mint"),Preference("Neapolitan", 0, "Neapolitan"),Preference("Neapolitan", 2, "Vanilla"),Preference("Neapolitan", 2, "Butter Pecan")),listOf(Preference("Vanilla", 0, "Chocolate Chip"),Preference("Vanilla", 0, "Chocolate"),Preference("Vanilla", 2, "Mint"),Preference("Vanilla", 1, "Neapolitan"),Preference("Vanilla", 0, "Vanilla"),Preference("Vanilla", 3, "Butter Pecan")),listOf(Preference("Butter Pecan", 0, "Chocolate Chip"),Preference("Butter Pecan", 0, "Chocolate"),Preference("Butter Pecan", 1, "Mint"),Preference("Butter Pecan", 1, "Neapolitan"),Preference("Butter Pecan", 0, "Vanilla"),Preference("Butter Pecan", 0, "Butter Pecan"))), listOf(listOf(Preference("Chocolate Chip", 0, "Chocolate Chip"),Preference("Chocolate Chip", 2, "Chocolate"),Preference("Chocolate Chip", 2, "Mint"),Preference("Chocolate Chip", 3, "Neapolitan"),Preference("Chocolate Chip", 3, "Vanilla"),Preference("Chocolate Chip", 3, "Butter Pecan")),listOf(Preference("Chocolate", 1, "Chocolate Chip"),Preference("Chocolate", 0, "Chocolate"),Preference("Chocolate", 2, "Mint"),Preference("Chocolate", 2, "Mint") + Preference("Mint", 2, "Neapolitan"),Preference("Chocolate", 3, "Vanilla"),Preference("Chocolate", 3, "Butter Pecan")),listOf(Preference("Mint", 1, "Chocolate Chip"),Preference("Mint", 2, "Neapolitan") + Preference("Neapolitan", 2, "Chocolate"),Preference("Mint", 0, "Mint"),Preference("Mint", 2, "Neapolitan"),Preference("Mint", 2, "Neapolitan") + Preference("Neapolitan", 2, "Vanilla"),Preference("Mint", 2, "Butter Pecan")),listOf(Preference("Neapolitan", 2, "Chocolate") + Preference("Chocolate", 1, "Chocolate Chip"),Preference("Neapolitan", 2, "Chocolate"),Preference("Neapolitan", 2, "Chocolate") + Preference("Chocolate", 2, "Mint"),Preference("Neapolitan", 0, "Neapolitan"),Preference("Neapolitan", 2, "Vanilla"),Preference("Neapolitan", 2, "Butter Pecan")),listOf(Preference("Vanilla", 2, "Mint") + Preference("Mint", 1, "Chocolate Chip"),Preference("Vanilla", 2, "Mint") + Preference("Mint", 2, "Neapolitan") + Preference("Neapolitan", 2, "Chocolate"),Preference("Vanilla", 2, "Mint"),Preference("Vanilla", 2, "Mint") + Preference("Mint", 2, "Neapolitan"),Preference("Vanilla", 0, "Vanilla"),Preference("Vanilla", 3, "Butter Pecan")),listOf(Preference("Butter Pecan", 1, "Mint") + Preference("Mint", 1, "Chocolate Chip"),Preference("Butter Pecan", 1, "Mint") + Preference("Mint", 1, "Chocolate"),Preference("Butter Pecan", 1, "Mint"),Preference("Butter Pecan", 1, "Neapolitan"),Preference("Butter Pecan", 1, "Mint") + Preference("Mint", 1, "Vanilla"),Preference("Butter Pecan", 0, "Butter Pecan"))), listOf(Place(1, "Chocolate Chip"),Place(2, "Chocolate"),Place(2, "Mint"),Place(2, "Neapolitan"),Place(5, "Vanilla"),Place(6, "Butter Pecan")), listOf("Alice","Bob","Dave"))

getBallot(AccessToken("Alice", OWNER), "Alice", "Favorite Ice Cream")
BallotSummary("Alice", "Favorite Ice Cream", "D7ED737E6DF479C9EA2E6B28B416A733", Instant.parse("2022-01-21T06:18:26.481986Z"))

