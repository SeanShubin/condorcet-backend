"select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""use condorcet_regression_test_event""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""use condorcet_regression_test_state""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:47:44.946811', 'Alice', 'SetRole', '{\"name\":\"Bob\",\"role\":\"USER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""update user\nset role='USER'\nwhere name = 'Bob'\n""update int_variable\nset value = 4\nwhere name = 'last-synced'\n""drop database if exists condorcet_regression_test_event""drop database if exists condorcet_regression_test_state""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'""create database condorcet_regression_test_event""use condorcet_regression_test_event""create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)""select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'""create database condorcet_regression_test_state""use condorcet_regression_test_state""create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)""create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)""create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)""create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)""create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)""alter table candidate add unique unique_candidate(election_id, name)""create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)""alter table voter add unique unique_voter(election_id, user_id)""create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)""alter table ballot add unique unique_ballot(user_id, election_id)""create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)""alter table ranking add unique unique_ranking(ballot_id, candidate_id)""create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)""alter table tally add unique unique_tally(election_id)""insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')""insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')""insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into int_variable (name, value)\nvalues ('last-synced', 0)\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n""update int_variable\nset value = 1\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n""update int_variable\nset value = 2\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n""select count(id)\nfrom user\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n""update int_variable\nset value = 3\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:47:44.946811', 'Alice', 'SetRole', '{\"name\":\"Bob\",\"role\":\"USER\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""update user\nset role='USER'\nwhere name = 'Bob'\n""update int_variable\nset value = 4\nwhere name = 'last-synced'\n""select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n""insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:49:06.420277', 'Alice', 'RemoveUser', '{\"name\":\"Carol\"}')\n""select value\nfrom int_variable\nwhere name = 'last-synced'\n""delete\nfrom user\nwhere name = 'Carol'""update int_variable\nset value = 5\nwhere name = 'last-synced'\n""drop database if exists condorcet_regression_test_event"
"drop database if exists condorcet_regression_test_state"
"select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'"
"create database condorcet_regression_test_event"
"use condorcet_regression_test_event"
"create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)"
"select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'"
"create database condorcet_regression_test_state"
"use condorcet_regression_test_state"
"create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)"
"create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)"
"create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)"
"create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)"
"create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)"
"alter table candidate add unique unique_candidate(election_id, name)"
"create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)"
"alter table voter add unique unique_voter(election_id, user_id)"
"create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)"
"alter table ballot add unique unique_ballot(user_id, election_id)"
"create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)"
"alter table ranking add unique unique_ranking(ballot_id, candidate_id)"
"create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)"
"alter table tally add unique unique_tally(election_id)"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into int_variable (name, value)\nvalues ('last-synced', 0)\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n"
"update int_variable\nset value = 1\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n"
"update int_variable\nset value = 2\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n"
"update int_variable\nset value = 3\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:47:44.946811', 'Alice', 'SetRole', '{\"name\":\"Bob\",\"role\":\"USER\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"update user\nset role='USER'\nwhere name = 'Bob'\n"
"update int_variable\nset value = 4\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:49:06.420277', 'Alice', 'RemoveUser', '{\"name\":\"Carol\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"delete\nfrom user\nwhere name = 'Carol'"
"update int_variable\nset value = 5\nwhere name = 'last-synced'\n"
"drop database if exists condorcet_regression_test_event"
"drop database if exists condorcet_regression_test_state"
"select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_event'"
"create database condorcet_regression_test_event"
"use condorcet_regression_test_event"
"create table event (\n    id int not null auto_increment,\n    `when` datetime(6) not null,\n    authority varchar(255) not null,\n    type varchar(255) not null,\n    text text not null,\n    primary key(id)\n)"
"select count(*) from information_schema.schemata where schema_name = 'condorcet_regression_test_state'"
"create database condorcet_regression_test_state"
"use condorcet_regression_test_state"
"create table int_variable (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    value int not null,\n    primary key(id)\n)"
"create table role_permission (\n    id int not null auto_increment,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    permission ENUM('TRANSFER_OWNER','VIEW_SECRETS','MANAGE_USERS','USE_APPLICATION','VIEW_APPLICATION') not null,\n    primary key(id)\n)"
"create table user (\n    id int not null auto_increment,\n    name varchar(255) not null unique,\n    email varchar(255) not null unique,\n    salt varchar(255) not null,\n    hash varchar(255) not null,\n    role ENUM('OWNER','AUDITOR','ADMIN','USER','OBSERVER','UNASSIGNED') not null,\n    primary key(id)\n)"
"create table election (\n    id int not null auto_increment,\n    owner_id int not null,\n    foreign key fk_owner(owner_id) references user(id),\n    name varchar(255) not null unique,\n    end datetime(6),\n    secret boolean not null,\n    status ENUM('EDITING','LIVE','COMPLETE') not null,\n    primary key(id)\n)"
"create table candidate (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    name varchar(255) not null,\n    primary key(id)\n)"
"alter table candidate add unique unique_candidate(election_id, name)"
"create table voter (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    primary key(id)\n)"
"alter table voter add unique unique_voter(election_id, user_id)"
"create table ballot (\n    id int not null auto_increment,\n    user_id int not null,\n    foreign key fk_user(user_id) references user(id),\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    confirmation varchar(255) not null,\n    when_cast datetime(6) not null,\n    primary key(id)\n)"
"alter table ballot add unique unique_ballot(user_id, election_id)"
"create table ranking (\n    id int not null auto_increment,\n    ballot_id int not null,\n    foreign key fk_ballot(ballot_id) references ballot(id),\n    candidate_id int not null,\n    foreign key fk_candidate(candidate_id) references candidate(id),\n    `rank` int,\n    primary key(id)\n)"
"alter table ranking add unique unique_ranking(ballot_id, candidate_id)"
"create table tally (\n    id int not null auto_increment,\n    election_id int not null,\n    foreign key fk_election(election_id) references election(id),\n    report text not null,\n    primary key(id)\n)"
"alter table tally add unique unique_tally(election_id)"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'TRANSFER_OWNER')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_SECRETS')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('OWNER', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_SECRETS')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('AUDITOR', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'MANAGE_USERS')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('ADMIN', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('USER', 'USE_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('USER', 'VIEW_APPLICATION')"
"insert into role_permission (role, permission)\nvalues ('OBSERVER', 'VIEW_APPLICATION')"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into int_variable (name, value)\nvalues ('last-synced', 0)\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'alice@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.715621', 'Alice', 'AddUser', '{\"name\":\"Alice\",\"email\":\"alice@email.com\",\"salt\":\"8d027cff-d538-4078-8de9-b15c0c46d383\",\"hash\":\"972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4\",\"role\":\"OWNER\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Alice', 'alice@email.com', '8d027cff-d538-4078-8de9-b15c0c46d383', '972A59B9F4F03166E3023CFE496F179F1AEACBAC0D8BEA2A5E28676D384A2BC4', 'OWNER')\n"
"update int_variable\nset value = 1\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'bob@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.863825', 'Bob', 'AddUser', '{\"name\":\"Bob\",\"email\":\"bob@email.com\",\"salt\":\"9cfdf833-a1cb-487a-bf8e-a2efd8b209a4\",\"hash\":\"7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C\",\"role\":\"UNASSIGNED\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Bob', 'bob@email.com', '9cfdf833-a1cb-487a-bf8e-a2efd8b209a4', '7961966BF84F86F943E0B56DB8CF66075CB7B160811FF2995107F7715D4F9D6C', 'UNASSIGNED')\n"
"update int_variable\nset value = 2\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere email = 'carol@email.com'\n"
"select count(id)\nfrom user\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 07:56:19.907919', 'Carol', 'AddUser', '{\"name\":\"Carol\",\"email\":\"carol@email.com\",\"salt\":\"9c24ff2a-9f85-45cc-8f83-50974f93bc80\",\"hash\":\"1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9\",\"role\":\"UNASSIGNED\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"insert into user (name,\n                  email,\n                  salt,\n                  hash,\n                  role)\nvalues ('Carol', 'carol@email.com', '9c24ff2a-9f85-45cc-8f83-50974f93bc80', '1F7CAB856AEE2DF4AE89369F2CF3C6B51856655B16E945BBB1E39D81CABB37E9', 'UNASSIGNED')\n"
"update int_variable\nset value = 3\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Alice'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Bob'\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:47:44.946811', 'Alice', 'SetRole', '{\"name\":\"Bob\",\"role\":\"USER\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"update user\nset role='USER'\nwhere name = 'Bob'\n"
"update int_variable\nset value = 4\nwhere name = 'last-synced'\n"
"select name,\n       email,\n       salt,\n       hash,\n       role\nfrom user\nwhere name = 'Carol'\n"
"insert into event (`when`, authority, type, text)\nvalues ('2021-02-15 08:49:06.420277', 'Alice', 'RemoveUser', '{\"name\":\"Carol\"}')\n"
"select value\nfrom int_variable\nwhere name = 'last-synced'\n"
"delete\nfrom user\nwhere name = 'Carol'"
"update int_variable\nset value = 5\nwhere name = 'last-synced'\n"
